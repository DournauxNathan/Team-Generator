<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Generator</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>Team Generator</h1>
    <div id="people"></div>
    <br>
    <div>
        <button id="generateButton">Generate Teams</button>
    </div>
    <div id="teams"></div>

    <script>
        const people = [
            { name: "Alice", city: "PARIS" },
            { name: "Bob", city: "PARIS" },
            { name: "Charlie", city: "PARIS" },
            { name: "David", city: "PARIS" },
            { name: "Eva", city: "PARIS" },
            { name: "Fay", city: "PARIS" },
            { name: "George", city: "LYON" },
            { name: "Hannah", city: "LYON" },
            { name: "Ivan", city: "PARIS" },
            { name: "Jack", city: "PARIS" },
            { name: "Kate", city: "PARIS" },
            { name: "Leo", city: "PARIS" },
            { name: "Mia", city: "LILLE" },
            { name: "Noah", city: "LILLE" },
            { name: "Olivia", city: "LILLE" },
            { name: "Paul", city: "LILLE" },
            { name: "Quinn", city: "LILLE" },
            { name: "Rita", city: "LILLE" },
            { name: "Sam", city: "PARIS" },
            { name: "Tina", city: "PARIS" },
            { name: "Uma", city: "PARIS" },
            { name: "Vince", city: "PARIS" },
            { name: "Wendy", city: "LYON" },
            { name: "Xander", city: "LYON" },
            { name: "Yara", city: "LYON" },
            { name: "Zane", city: "PARIS" },
            { name: "Ava", city: "PARIS" },
            { name: "Ben", city: "PARIS" },
            { name: "Cora", city: "PARIS" },
            { name: "Dylan", city: "PARIS" },
            { name: "Ella", city: "PARIS" },
            { name: "Finn", city: "PARIS" },
            { name: "Gina", city: "PARIS" },
            { name: "Hugo", city: "PARIS" },
            { name: "Ivy", city: "LYON" },
            { name: "Jake", city: "LYON" },
            { name: "Kira", city: "LILLE" },
            { name: "Leo", city: "LILLE" },
            { name: "Mila", city: "PARIS" },
            { name: "Nina", city: "PARIS" }
        ];

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function updateShuffledNames(teams) {
            const teamsDiv = document.getElementById('teams');
            const flatTeamMembers = teams.flat();

            const intervalId = setInterval(() => {
                shuffleArray(flatTeamMembers);
                const shuffledNames = flatTeamMembers.map(p => `<span class="shuffled-person">${p.name}</span>`).join(' ');
                teamsDiv.innerHTML = `<h2>Shuffling Names...</h2>${shuffledNames}`;
            }, 300);

            // Stop shuffling after 3 seconds and display the final teams
            setTimeout(() => {
                clearInterval(intervalId);
                displayFinalTeams(teams);
            }, 3000);
        }

        function displayFinalTeams(teams) {
            const teamsDiv = document.getElementById('teams');
            teamsDiv.innerHTML = "<h2>Generated Teams</h2>";
            teams.forEach((team, index) => {
                const teamInfo = team.map(p => `<span class="person" title="${p.city}">${p.name}</span>`).join(' ');
                teamsDiv.innerHTML += `<div class="team">Team ${index + 1}: ${teamInfo}</div>`;
            });
        }

        function generateTeams() {
            const teamCount = 8;
            const peoplePerTeam = 5;
            const teams = Array.from({ length: teamCount }, () => []);
            const cities = { "PARIS": [], "LYON": [], "LILLE": [] };

            // Fill cities array
            people.forEach(person => cities[person.city].push(person));

            // Total people check
            let totalPeople = teamCount * peoplePerTeam;
            if (totalPeople > people.length) {
                alert("Not enough available people for the requested number of teams and team size.");
                return;
            }

            const uniqueCities = Object.keys(cities).filter(city => cities[city].length > 0);

            for (let i = 0; i < teamCount; i++) {
                const assignedCities = new Set(); // Track cities already assigned to the current team
                let teamMembersCount = 0;

                // Fill the team with unique cities first
                while (teamMembersCount < peoplePerTeam) {
                    const cityKeys = uniqueCities.filter(city => cities[city].length > 0 && !assignedCities.has(city));
                    
                    if (cityKeys.length > 0) {
                        const city = cityKeys[Math.floor(Math.random() * cityKeys.length)];
                        const index = Math.floor(Math.random() * cities[city].length);
                        const selectedPerson = cities[city][index];
                        teams[i].push(selectedPerson);
                        assignedCities.add(city);
                        cities[city].splice(index, 1); // Remove the person from the list
                        teamMembersCount++;
                    } else {
                        break; // No more unique cities left
                    }
                }

                // If the team is not filled, start reassigning from the available cities
                while (teamMembersCount < peoplePerTeam) {
                    const cityKeys = uniqueCities.filter(city => cities[city].length > 0);
                    if (cityKeys.length === 0) break; // No more people left to assign
                    
                    const city = cityKeys[Math.floor(Math.random() * cityKeys.length)];
                    const index = Math.floor(Math.random() * cities[city].length);
                    const selectedPerson = cities[city][index];
                    teams[i].push(selectedPerson);
                    cities[city].splice(index, 1); // Remove the person from the list
                    teamMembersCount++;
                }
            }

            // Start the live shuffling animation
            updateShuffledNames(teams);
        }

        document.getElementById('generateButton').addEventListener('click', generateTeams);

        function displayPeople() {
            const peopleDiv = document.getElementById('people');
            peopleDiv.innerHTML = people.map(person => `<span class="person">${person.name}</span>`).join(' ');
        }

        displayPeople();
    </script>
</body>
</html>
