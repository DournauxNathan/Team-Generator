<!DOCTYPE html>
<html lang="fr">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Générateur d'Équipes</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>Générateur d'Équipes</h1>
    <div id="availablePeople" class="person"></div>
    <div id="availableCount"></div>
    <br>
    <div>
        <button id="generateButton">Générer Équipes</button>
    </div>
    <div id="teams"></div>

    <script>
        const people = [
            { entity: "ENTITE_A", function: "DEVELOPPEUR", name: "Alice", confirmed: 1 },
            { entity: "ENTITE_A", function: "DEVELOPPEUR", name: "Bob", confirmed: 1 },
            { entity: "ENTITE_A", function: "ASSISTANT", name: "Charlie", confirmed: 1 },
            { entity: "ENTITE_A", function: "CHEF_DE_PROJET", name: "David", confirmed: 1 },
            { entity: "ENTITE_A", function: "ANALYSTE", name: "Eve", confirmed: 1 },
            { entity: "ENTITE_B", function: "DEVELOPPEUR", name: "Frank", confirmed: 1 },
            { entity: "ENTITE_A", function: "TESTEUR", name: "Grace", confirmed: 1 },
            { entity: "ENTITE_A", function: "MANAGER", name: "Heidi", confirmed: 1 },
            { entity: "ENTITE_B", function: "DEVELOPPEUR", name: "Ivan", confirmed: 1 },
            { entity: "ENTITE_A", function: "MANAGER", name: "Judy", confirmed: 1 },
            { entity: "ENTITE_A", function: "DEVELOPPEUR", name: "Mallory", confirmed: 1 },
            { entity: "ENTITE_C", function: "DEVELOPPEUR", name: "Niaj", confirmed: 1 },
            { entity: "ENTITE_B", function: "DEVELOPPEUR", name: "Olivia", confirmed: 1 },
            { entity: "ENTITE_A", function: "MANAGER", name: "Peggy", confirmed: 1 },
            { entity: "ENTITE_A", function: "TESTEUR", name: "Sybil", confirmed: 1 },
            { entity: "ENTITE_C", function: "TESTEUR", name: "Trent", confirmed: 1 },
            { entity: "ENTITE_C", function: "TESTEUR", name: "Victor", confirmed: 1 },
            { entity: "ENTITE_A", function: "ASSISTANT", name: "Walter", confirmed: 1 },
            { entity: "ENTITE_A", function: "ANALYSTE", name: "Xena", confirmed: 1 },
            { entity: "ENTITE_B", function: "DEVELOPPEUR", name: "Yara", confirmed: 1 },
            { entity: "ENTITE_B", function: "ANALYSTE", name: "Zack", confirmed: 1 },
            { entity: "ENTITE_A", function: "DEVELOPPEUR", name: "Zoe", confirmed: 1 },
            { entity: "ENTITE_B", function: "CHEF_DE_PROJET", name: "Aiden", confirmed: 1 },
            { entity: "ENTITE_C", function: "ANALYSTE", name: "Bella", confirmed: 1 },
            { entity: "ENTITE_A", function: "MANAGER", name: "Caleb", confirmed: 1 },
            { entity: "ENTITE_B", function: "DEVELOPPEUR", name: "Daisy", confirmed: 1 },
            { entity: "ENTITE_A", function: "ANALYSTE", name: "Ethan", confirmed: 1 },
            { entity: "ENTITE_A", function: "CHEF_DE_PROJET", name: "Finn", confirmed: 1 },
            { entity: "ENTITE_B", function: "DEVELOPPEUR", name: "Grace", confirmed: 1 },
            { entity: "ENTITE_A", function: "MANAGER", name: "Henry", confirmed: 1 },
            { entity: "ENTITE_B", function: "DEVELOPPEUR", name: "Ivy", confirmed: 1 },
            { entity: "ENTITE_A", function: "ANALYSTE", name: "Jack", confirmed: 1 },
            { entity: "ENTITE_A", function: "TESTEUR", name: "Karen", confirmed: 1 },
            { entity: "ENTITE_C", function: "DEVELOPPEUR", name: "Leo", confirmed: 1 },
            { entity: "ENTITE_A", function: "CHEF_DE_PROJET", name: "Maya", confirmed: 1 },
            { entity: "ENTITE_A", function: "ASSISTANT", name: "Nina", confirmed: 1 },
            { entity: "ENTITE_B", function: "CHEF_DE_PROJET", name: "Oscar", confirmed: 1 },
            { entity: "ENTITE_C", function: "TESTEUR", name: "Paula", confirmed: 1 },
            { entity: "ENTITE_A", function: "TESTEUR", name: "Téo", confirmed: 1 },
            { entity: "ENTITE_A", function: "ASSISTANT", name: "Laura", confirmed: 1 },
        ];


        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function displayAvailableCount() {
            const availablePeople = people.filter(person => person.confirmed === 1);
            const countDiv = document.getElementById('availableCount');
            const availableDiv = document.getElementById('availablePeople');

            countDiv.innerHTML = `Nombre de personnes disponibles : ${availablePeople.length}`;
    
            // Utilisation de HTML pour styliser chaque personne
            availableDiv.innerHTML = "<strong>Personnes disponibles :</strong><br>" + 
                availablePeople.map(p => `<span class="person" title="${p.function}">${p.name}</span>`).join(' ');
        }

        function updateShuffledNames(teams) {
            const teamsDiv = document.getElementById('teams');
            const flatTeamMembers = teams.flat();

            const intervalId = setInterval(() => {
                shuffleArray(flatTeamMembers);
                const shuffledNames = flatTeamMembers.map(p => `<span class="shuffled-person">${p.name}</span>`).join(' ');
                teamsDiv.innerHTML = `<h2>Shuffling Names...</h2>${shuffledNames}`;
            }, 300);

            // Stop shuffling after 3 seconds and display the final teams
            setTimeout(() => {
                clearInterval(intervalId);
                displayFinalTeams(teams);
            }, 3000);
        }

        function displayFinalTeams(teams) {
            const teamsDiv = document.getElementById('teams');
            teamsDiv.innerHTML = "<h2>Équipes Générées</h2>";
            teams.forEach((team, index) => {
                const teamInfo = team.map(p => `<span class="person" title="${p.entity}, ${p.function}">${p.name}</span>`).join(' ');
                teamsDiv.innerHTML += `<div class="team">Équipe ${index + 1}: ${teamInfo}</div>`;
            });
        }

        function generateTeams() {
            const teamCount = 8; // Nombre d'équipes à créer
            const peoplePerTeam = 5; // Nombre de personnes par équipe
            const teams = Array.from({ length: teamCount }, () => []);
            const availablePeople = people.filter(person => person.confirmed === 1);
            const uniqueEntities = [...new Set(availablePeople.map(person => person.entity))];
            const uniqueFunctions = [...new Set(availablePeople.map(person => person.function))];

            // Total people check
            let totalPeople = teamCount * peoplePerTeam;
            if (totalPeople > availablePeople.length) {
                alert("Pas assez de personnes disponibles pour le nombre d'équipes et de personnes par équipe demandé.");
                return;
            }

            // Mélanger les personnes disponibles pour une distribution aléatoire
            shuffleArray(availablePeople);

            // Remplir les équipes avec la priorité de mélange d'entités et de fonctions
            for (let i = 0; i < teamCount; i++) {
                const assignedEntities = new Set(); // Suivre les entités déjà assignées à l'équipe actuelle
                const assignedFunctions = new Set(); // Suivre les fonctions déjà assignées à l'équipe actuelle

                for (let j = 0; j < peoplePerTeam; j++) {
                    for (let k = 0; k < availablePeople.length; k++) {
                        const person = availablePeople[k];

                        // Vérifier si la personne peut être ajoutée à l'équipe
                        if (!assignedEntities.has(person.entity) && !assignedFunctions.has(person.function)) {
                            teams[i].push(person);
                            assignedEntities.add(person.entity);
                            assignedFunctions.add(person.function);
                            availablePeople.splice(k, 1); // Retirer la personne de la liste disponible
                            break;
                        }
                    }
                }
            }

            // Distribution des personnes restantes si nécessaire
            let remainingPeople = availablePeople.length;
            if (remainingPeople > 0) {
                for (let i = 0; i < teamCount && remainingPeople > 0; i++) {
                    while (teams[i].length < peoplePerTeam && remainingPeople > 0) {
                        teams[i].push(availablePeople.pop()); // Ajouter une personne restante à l'équipe
                        remainingPeople--;
                    }
                }
            }

            // Afficher les équipes avec un effet de shuffle
            updateShuffledNames(teams);
        }

        document.getElementById('generateButton').addEventListener('click', () => {
            displayAvailableCount();
            generateTeams();
        });

        // Initial call to display available count
        displayAvailableCount();
    </script>
</body>
</html>
